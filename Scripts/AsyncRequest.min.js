/*
 * Copyright 2013 Poligono Software, Inc. and other contributors
 * Released under the MIT license
*/
(function(a){a.fn.asyncRequest=new function(){var b=this;b.init=function(c){var d={};a.extend(true,d,a.asyncRequest.defaults);a.extend(true,d,c);if(d.notification.notifyFunction===null){d.notification.notifyFunction=b.NotifyDefault}return d};b.UnBlock=function(c,e){if(c!==false){if(c===null){c=window}for(var f=0;f<a.fn.asyncRequest.blockArray.length;f++){var d=a.fn.asyncRequest.blockArray[f].element;if(a(d).is(a(c))){if(a.fn.asyncRequest.blockArray[f].count>1){if(e!=null){e()}a.fn.asyncRequest.blockArray[f].count--}else{a(c).unblock({onUnblock:e});a.fn.asyncRequest.blockArray[f].count=0}}}}};b.ConfigurarAntesRequest=function(k,c,l){if(c.Msg===null||c.Msg===undefined){c.Msg=k.loadTextTemplate.replace("${msg}",k.loadText)}if(c.Containner!==false){var d=c.Containner;if(d===null){d=window}var e=null;for(var j=0;j<a.fn.asyncRequest.blockArray.length;j++){var e=a.fn.asyncRequest.blockArray[j].element;if(a(e).is(a(d))){if(a.fn.asyncRequest.blockArray[j].count==0){a(d).block({message:c.Msg,blockMsgClass:k.cssBlockUI})}a.fn.asyncRequest.blockArray[j].count++;break}else{e=null}}if(e==null){a.fn.asyncRequest.blockArray.push({element:d,count:1});a(d).block({message:c.Msg,blockMsgClass:k.cssBlockUI})}}if(c.Data===null){c.DataRequest={}}else{if(c.ContentType.indexOf("application/json")!==-1){c.DataRequest=JSON.stringify(c.Data)}else{c.DataRequest=c.Data}}if(c.SuccessFunction!==false){var f=c.SuccessFunction;c.SuccessFunction=function(i){if(c.UnblockMoment==="before"){var m=null;if(f!==null){m=function(){f(i)}}b.UnBlock(c.Containner,m)}else{if(f!==null){f(i)}b.UnBlock(c.Containner)}b.ExecuteNotify(i,k,l,"success")}}if(c.ErrorFunction!==false){var h=c.ErrorFunction;c.ErrorFunction=function(i){if(c.UnblockMoment==="before"){var m=null;if(h!==null){m=function(){h(i)}}b.UnBlock(c.Containner,m)}else{if(h!==null){h(i)}b.UnBlock(c.Containner)}b.ExecuteNotify(i,k,l,"erro")}}if(c.CompleteFunction!==false){var g=c.CompleteFunction;c.CompleteFunction=function(i){if(g!==null){g(i)}}}};b.ConfigRequest=function(d,c){var e=a.ajax({type:d,url:c.Url,data:c.DataRequest,contentType:c.ContentType,success:c.SuccessFunction,error:c.ErrorFunction,complete:c.CompleteFunction,dataType:c.DataType,timeout:c.Timeout});return e};b.ExecuteNotify=function(c,e,f,d){if(e.notification.notifyFunction!==null){e.notification.notifyCommandType.forEach(function(g){if(g===f&&e.notification.notifyFunction!==false){e.notification.notifyFunction(d,c,e)}})}};b.NotifyDefault=function(j,d,c){var h=null,g,i;if(a.jGrowl!==null){h=new asyncRequest_Notification_JGrowl(c.notification)}else{if(a.noty!==null){h=new asyncRequest_Notification_Notfy(c.notification)}}try{var f=JSON.parse(d.responseText);if(typeof f=="string"){g=f}else{g=f.errorMessage||f.Message;if(f.ExceptionMessage+!null){i=f.ExceptionMessage}if(f.StackTrace!=null){if(i==null){i=f.StackTrace}else{i+="<br/>"+f.StackTrace}}}}catch(e){if(d.responseText!==null&&d.responseText!==""){g=d.responseText}else{g=d.Message===null?d.statusText:d.Message}}switch(j){case"success":h.successNotify(g);break;case"erro":h.erroNotify(g,i,true);break;case"info":h.notifyInfo(g);break}};b.getObjAsync=function(c){var d=b.init(c);return Object.create(d.asyncObject)};b.getAsync=function(j,d,c,i,e,f,h){var g=b.getObjAsync();g.Url=j;g.Data=d;g.SuccessFunction=i;g.ErrorFunction=e;g.Msg=f;g.Queue=h;g.Containner=c;b.get(g)};b.get=function(c,d){var f=b.init(d);c=a.extend(true,f.asyncObject,c);var e=function(){b.ConfigurarAntesRequest(f,c,"GET");return b.ConfigRequest("GET",c)};return b.ExecuteFunction(c,e)};b.post=function(c,d){var f=b.init(d);c=a.extend(true,f.asyncObject,c);var e=function(){b.ConfigurarAntesRequest(f,c,"POST");return b.ConfigRequest("POST",c)};return b.ExecuteFunction(c,e)};b.put=function(c,d){var f=b.init(d);c=a.extend(true,f.asyncObject,c);var e=function(){b.ConfigurarAntesRequest(f,c,"PUT");return b.ConfigRequest("PUT",c)};return b.ExecuteFunction(c,e)};b["delete"]=function(c,d){var f=b.init(d);c=a.extend(true,f.asyncObject,c);var e=function(){b.ConfigurarAntesRequest(f,c,"DELETE");return b.ConfigRequest("DELETE",c)};return b.ExecuteFunction(c,e)};b.getAjax=function(){return a.asyncRequest.defaults.ajax};b.ExecuteFunction=function(c,d){var g=a.asyncRequest.defaults.queueUtil,e=g.configQueue(c);if(e!==null){var f=g.getQueue(e);f.queue.push(function(){return d()});if(!f.Executing){f.Executing=true;f.queue.execute()}}else{return d()}};b.NotifyMsg=function(e,c){var d={errorMessage:e||null,ExceptionMessage:c||null,StackTrace:null};return{responseText:JSON.stringify(d)}};b.NotifySuccess=function(d){var e=b.init();var c=b.NotifyMsg(d);b.NotifyDefault("success",c,e)};b.NotifyErro=function(d,f){var e=b.init();var c=b.NotifyMsg(d,f);b.NotifyDefault("erro",c,e)};b.NotifyInfo=function(d){var e=b.init();var c=b.NotifyMsg(d);b.NotifyDefault("info",c,e)};return{getAsync:b.getAsync,get:b.get,post:b.post,put:b.put,"delete":b["delete"],getObjAsync:b.getObjAsync,getAjax:b.getAjax,notifySuccess:b.NotifySuccess,notifyErro:b.NotifyErro,notifyInfo:b.NotifyInfo}};a.asyncRequest=a.fn.asyncRequest;a.fn.asyncRequest.blockArray=[];a.asyncRequest.defaults={ajax:a.ajax,loadText:"Carregando..",loadTextTemplate:"<div class='MenssagemLoad'><h4>${msg}</h4></div>",cssBlockUI:"asyncRequestBlockMsg",queueUtil:new asyncRequest_Queue(),asyncObject:{Url:null,Data:null,Cache:false,Containner:null,Msg:null,Queue:null,ContentType:"application/json; charset=utf-8",DataType:"json",UnblockMoment:"after",Timeout:0,SuccessFunction:null,ErrorFunction:null,CompleteFunction:null},notification:{notifyFunction:null,notifyCommandType:["POST","PUT","DELETE"],notifyTemplate:"<div><div class='notificationTemplate'><p></p><p class='notificationTemplateMsg'>${msg}</p></div></div>",notifyTemplateErro:"<div><div class='notificationTemplate'><p></p><p class='notificationTemplateMsg'>${msg}</p><ul class='msgStack'><li><a onclick=\"$(this).parent().parent().find('li:last').toggle();\">${fullErroText}</a></li><li>${msgStack}</li></ul></div></div>",notificationSuccessMsgDefault:"Operação realizada com sucesso",notificationErrorMsgDefault:"Ocorreu um erro ao realizar a operação",fullErroText:"Erro Completo"}}})(jQuery);