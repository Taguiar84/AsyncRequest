/*
 * Copyright 2013 Poligono Software, Inc. and other contributors
 * Released under the MIT license
*/
(function(a){a.fn.asyncRequest=new function(){var b=this;b.init=function(c){var d={};a.extend(true,d,a.asyncRequest.defaults);a.extend(true,d,c);if(d.notification.notifyFunction===null){d.notification.notifyFunction=b.NotifyDefault}return d};b.Unblock=function(c,d){if(c!==false){if(c===null){a.unblockUI({onUnblock:d})}else{a(c).unblock({onUnblock:d})}}};b.ConfigurarAntesRequest=function(g,c,h){if(c.Msg===null||c.Msg===undefined){c.Msg=g.loadTextTemplate.replace("${msg}",g.loadText)}if(c.Containner!==false){if(c.Containner===null){a.blockUI({message:c.Msg,blockMsgClass:"asyncRequestBlockMsg"})}else{a(c.Containner).block({message:c.Msg,blockMsgClass:"asyncRequestBlockMsg"})}}if(c.Data===null){c.DataRequest={}}else{if(c.ContentType.indexOf("application/json")!==-1){c.DataRequest=JSON.stringify(c.Data)}else{c.DataRequest=c.Data}}if(c.SuccessFunction!==false){var d=c.SuccessFunction;c.SuccessFunction=function(i){if(c.UnblockMoment==="before"){var j=null;if(d!==null){j=function(){d(i)}}b.Unblock(c.Containner,j)}else{if(d!==null){d(i)}b.Unblock(c.Containner)}b.ExecuteNotify(i,g,h,"success")}}if(c.ErrorFunction!==false){var f=c.ErrorFunction;c.ErrorFunction=function(i){if(c.UnblockMoment==="before"){var j=null;if(f!==null){j=function(){f(i)}}b.Unblock(c.Containner,j)}else{if(f!==null){f(i)}b.Unblock(c.Containner)}b.ExecuteNotify(i,g,h,"erro")}}if(c.CompleteFunction!==false){var e=c.CompleteFunction;c.CompleteFunction=function(i){if(e!==null){e(i)}}}};b.ConfigRequest=function(d,c){a.ajax({type:d,url:c.Url,data:c.DataRequest,contentType:c.ContentType,success:c.SuccessFunction,error:c.ErrorFunction,complete:c.CompleteFunction,dataType:c.DataType})};b.ExecuteNotify=function(c,e,f,d){if(e.notification.notifyFunction!==null){e.notification.notifyCommandType.forEach(function(g){if(g===f&&e.notification.notifyFunction!==false){e.notification.notifyFunction(d,c,e)}})}};b.NotifyDefault=function(j,d,c){var h=null,g,i;if(a.jGrowl!==null){h=new asyncRequest_Notification_JGrowl(c.notification)}else{if(a.noty!==null){h=new asyncRequest_Notification_Notfy(c.notification)}}switch(j){case"success":h.successNotify();break;case"erro":try{var f=JSON.parse(d.responseText);g=f.errorMessage;i=f.ExceptionMessage+"<br/>"+f.StackTrace}catch(e){if(d.responseText!==null&&d.responseText!==""){g=d.responseText}else{g=d.Message===null?d.statusText:d.Message}}h.erroNotify(g,i,true);break;case"info":h.notifyInfo();break}};b.getObjAsync=function(c){var d=b.init(c);return Object.create(d.asyncObject)};b.getAsync=function(j,d,c,i,e,f,h){var g=b.getObjAsync();g.Url=j;g.Data=d;g.SuccessFunction=i;g.ErrorFunction=e;g.Msg=f;g.Queue=h;g.Containner=c;b.get(g)};b.get=function(c,d){var f=b.init(d);c=a.extend(true,f.asyncObject,c);var e=function(){b.ConfigurarAntesRequest(f,c,"GET");b.ConfigRequest("GET",c)};b.ExecuteFunction(c,e)};b.post=function(c,d){var f=b.init(d);c=a.extend(true,f.asyncObject,c);var e=function(){b.ConfigurarAntesRequest(f,c,"POST");b.ConfigRequest("POST",c)};b.ExecuteFunction(c,e)};b.put=function(c,d){var f=b.init(d);c=a.extend(true,f.asyncObject,c);var e=function(){b.ConfigurarAntesRequest(f,c,"UPDATE");b.ConfigRequest("UPDATE",c)};b.ExecuteFunction(c,e)};b["delete"]=function(c,d){var f=b.init(d);c=a.extend(true,f.asyncObject,c);var e=function(){b.ConfigurarAntesRequest(f,c);b.ConfigRequest("DELETE",c)};b.ExecuteFunction(c,e)};b.getAjax=function(){return a.asyncRequest.defaults.ajax};b.ExecuteFunction=function(c,d){var g=a.asyncRequest.defaults.queueUtil,e=g.configQueue(c);if(e!==null){var f=g.getQueue(e);f.queue.push(function(){d()});if(!f.Executing){f.Executing=true;f.queue.execute()}}else{d()}};return{getAsync:b.getAsync,get:b.get,post:b.post,put:b.put,"delete":b["delete"],getObjAsync:b.getObjAsync,getAjax:b.getAjax}};a.asyncRequest=a.fn.asyncRequest;a.asyncRequest.defaults={ajax:a.ajax,loadText:"Carregando..",loadTextTemplate:"<div class='MenssagemLoad'><h4>${msg}</h4></div>",queueUtil:new asyncRequest_Queue(),asyncObject:{Url:null,Data:null,Cache:false,Containner:null,Msg:null,Queue:null,ContentType:"application/json; charset=utf-8",DataType:"json",UnblockMoment:"after",SuccessFunction:null,ErrorFunction:null,CompleteFunction:null},notification:{notifyFunction:null,notifyCommandType:["POST","UPDATE","DELETE"],notifyTemplate:"<div><div class='notificationTemplate'><p></p><p class='notificationTemplateMsg'>${msg}</p></div></div>",notifyTemplateErro:"<div><div class='notificationTemplate'><p></p><p class='notificationTemplateMsg'>${msg}</p><br/><ul class='msgStack'><li><a onclick=\"$(this).parent().parent().find('li:last').toggle();\">${fullErroText}</a></li><li>${msgStack}</li></ul></div></div>",notificationSuccessMsgDefault:"Operação realizada com sucesso",notificationErrorMsgDefault:"Ocorreu um erro ao realizar a operação",fullErroText:"Erro Completo"}}})(jQuery);